<!DOCTYPE html>
<html>
<head>
  <title>Redirecting...</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding-top: 50px;
    }

    .loader {
      border: 16px solid #f3f3f3; /* Light grey */
      border-top: 16px solid #3498db; /* Blue */
      border-radius: 50%;
      width: 120px;
      height: 120px;
      animation: spin 2s linear infinite;
      margin: 20px auto;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>

  <script>
    function redirectToTarget() {
      const params = new URLSearchParams(window.location.search);
      const jobOpeningId = params.get("JobOpeningId");
      const postingSeq = params.get("PostingSeq");
      const siteId = params.get("SiteId");

      if (!jobOpeningId || !postingSeq || !siteId) {
        document.body.innerHTML = "<p style='color:red;'>Missing required parameters.</p>";
        return;
      }

      // Set dynamic page title
      document.title = `Job Opening: ${jobOpeningId}`;

      // Add Open Graph meta tag
      const ogMeta = document.createElement('meta');
      ogMeta.setAttribute('property', 'og:title');
      ogMeta.setAttribute('content', `JO: ${jobOpeningId}`);
      document.head.appendChild(ogMeta);

      // Add Twitter meta tag
      const twitterMeta = document.createElement('meta');
      twitterMeta.setAttribute('name', 'twitter:title');
      twitterMeta.setAttribute('content', `JO: ${jobOpeningId}`);
      document.head.appendChild(twitterMeta);

      // Final redirect URL
      const targetUrl = `https://careerspub.universityofcalifornia.edu/psc/ucdavis/EMPLOYEE/HRMS/c/HRS_HRAM_FL.HRS_CG_SEARCH_FL.GBL` +
        `?Page=HRS_APP_JBPST_FL` +
        `&JobOpeningId=${encodeURIComponent(jobOpeningId)}` +
        `&PostingSeq=${encodeURIComponent(postingSeq)}` +
        `&SiteId=${encodeURIComponent(siteId)}` +
        `&languageCd=ENG&FOCUS=Applicant`;

      // Write the generated URL
      document.getElementById("generatedUrl").innerHTML =
        `Generated URL: <a href="${targetUrl}" target="_blank">${targetUrl}</a>`;

      // Redirect after delay
      setTimeout(() => {
        window.location.href = targetUrl;
      }, 2000);
    }

    window.onload = redirectToTarget;
  </script>
</head>
<body>
  <div class="loader"></div>
  <p id="generatedUrl">Preparing URL...</p>
  <p>Redirecting in 2 seconds...</p>
</body>
</html>
